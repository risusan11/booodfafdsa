<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚µãƒ¼ãƒãƒ¼ä¸€è¦§</title>

<!-- â˜… ãƒ†ãƒ¼ãƒ -->
<link id="theme" rel="stylesheet" href="/css/light.css">
<script src="/script/theme.js" defer></script>

<style>
body{
  font-family:"Meiryo",sans-serif;
  background:var(--bg);
  color:var(--text);
  margin:0;
}

/* --- ä¸Šéƒ¨ãƒŠãƒ“ãƒãƒ¼ --- */
nav{
  background:var(--card);
  padding:12px 24px;
  display:flex;
  align-items:center;
  border-bottom:1px solid var(--border);
}

nav a{
  color:var(--text);
  text-decoration:none;
  font-weight:600;
  margin-right:20px;
  font-size:15px;
}
nav a:hover{
  color:var(--accent);
}

/* --- ã‚³ãƒ³ãƒ†ãƒŠ --- */
.container{
  width:92%;
  max-width:880px;
  margin:32px auto;
}

/* --- ã‚µãƒ¼ãƒãƒ¼ã‚«ãƒ¼ãƒ‰ --- */
.server{
  background:var(--card);
  border:1px solid var(--border);
  padding:18px 20px;
  margin-bottom:14px;
  border-radius:10px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  transition:0.2s ease;
}

.server:hover{
  transform:translateY(-2px);
  box-shadow:0 4px 14px rgba(0,0,0,0.07);
}

/* å‰Šé™¤ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
.server.fade-out{
  opacity:0;
  transform:translateX(-15px);
}

/* --- ã‚µãƒ¼ãƒãƒ¼åãƒªãƒ³ã‚¯ --- */
.server a{
  font-size:17px;
  color:var(--text);
  text-decoration:none;
  font-weight:600;
}
.server a:hover{
  color:var(--accent);
}

/* --- ãƒœã‚¿ãƒ³ --- */
button{
  padding:9px 14px;
  border:none;
  background:var(--accent);
  color:white;
  border-radius:6px;
  cursor:pointer;
  font-weight:600;
  transition:0.18s;
}
button:hover{
  opacity:0.9;
}

button.delete{
  background:#e34d4d;
}
button.delete:hover{
  opacity:0.85;
}

/* --- å…¥åŠ›æ¬„ --- */
input{
  width:100%;
  padding:11px 14px;
  border-radius:8px;
  border:1px solid var(--border);
  background:var(--input);
  color:var(--text);
  margin-bottom:12px;
  font-size:15px;
}
input:focus{
  outline:none;
  border-color:var(--accent);
}
</style>
</head>

<body>

<script>
// ------------------------------
// â˜… ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ãªã‘ã‚Œã°å¼·åˆ¶ãƒ­ã‚°ã‚¤ãƒ³
// ------------------------------
if (!localStorage.getItem("username")) {
  location.href = "/login.html";
}
</script>

<nav>
  <a href="/">ã‚µãƒ¼ãƒãƒ¼ä¸€è¦§</a>
  <a href="/tests.html">è‹±æ¤œ</a>
  <a href="/ranking.html">ãƒ©ãƒ³ã‚­ãƒ³ã‚°</a>
  <a href="/friend.html">ãƒ•ãƒ¬ãƒ³ãƒ‰</a>
  
  <a href="/friend_add.html"
     style="margin-left:8px; background:var(--accent); color:white; padding:6px 12px; border-radius:6px; text-decoration:none;">
    ï¼‹ãƒ•ãƒ¬ãƒ³ãƒ‰
  </a>

  <!-- â˜… å³ç«¯ã®ä¸¸ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ï¼‰ -->
  <img id="navProfileIcon"
       src="/icons/default.png"
       onclick="location.href='/profile.html'"
       style="width:34px; height:34px; border-radius:50%; object-fit:cover; margin-left:auto; cursor:pointer;">

  <!-- â˜… ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ -->
  <button onclick="logout()" style="margin-left:12px;">ğŸšª</button>

  <button onclick="toggleTheme()" style="margin-left:12px;">ğŸŒ“</button>
</nav>




<div class="container">
  <h2>ã‚µãƒ¼ãƒãƒ¼ä¸€è¦§</h2>

  <div>
    <input id="newServerName" placeholder="æ–°ã—ã„ã‚µãƒ¼ãƒãƒ¼åã‚’å…¥åŠ›">
    <button onclick="createServer()">ã‚µãƒ¼ãƒãƒ¼ä½œæˆ</button>
  </div>

  <h3 style="margin-top:24px; margin-bottom:10px;">ã‚µãƒ¼ãƒãƒ¼</h3>
  <div id="servers"></div>
</div>

<script>
// --------------------
// ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
// --------------------
function logout(){
  localStorage.removeItem("username");
  location.href = "/login.html";
}

// --------------------
// ãƒŠãƒ“å³ä¸Šã®ã‚¢ã‚¤ã‚³ãƒ³èª­ã¿è¾¼ã¿
// --------------------
async function loadNavIcon(){
  const user = localStorage.getItem("username");
  if (!user) return;

  const res = await fetch(`/api/user/profile?user=${user}`);
  const data = await res.json();

  const icon = document.getElementById("navProfileIcon");
  icon.src = data.icon || "/icons/default.png";
}

// --------------------
// ã‚µãƒ¼ãƒãƒ¼ä¸€è¦§èª­ã¿è¾¼ã¿
// --------------------
async function loadServers(){
  const res = await fetch("/api/servers");
  const servers = await res.json();

  const box = document.getElementById("servers");
  box.innerHTML = "";

  servers.forEach(s=>{
    const div = document.createElement("div");
    div.className = "server";
    div.id = "server-" + s.id;

    div.innerHTML = `
      <a href="/board.html?id=${s.id}">${s.name}</a>
      <button class="delete" onclick="deleteServer('${s.id}')">å‰Šé™¤</button>
    `;

    box.appendChild(div);
  });
}

// --------------------
// ã‚µãƒ¼ãƒãƒ¼ä½œæˆ
// --------------------
async function createServer(){
  const name = document.getElementById("newServerName").value.trim();
  if (!name) return alert("ã‚µãƒ¼ãƒãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");

  const res = await fetch("/api/servers", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ name })
  });

  const data = await res.json();
  if(data.error) return alert(data.error);

  document.getElementById("newServerName").value = "";
  loadServers();
}

// --------------------
// ã‚µãƒ¼ãƒãƒ¼å‰Šé™¤
// --------------------
async function deleteServer(id){
  if(!confirm("ã“ã®ã‚µãƒ¼ãƒãƒ¼ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\næŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿ã‚‚ã™ã¹ã¦å‰Šé™¤ã•ã‚Œã¾ã™ã€‚"))
    return;

  const div = document.getElementById("server-" + id);
  div.classList.add("fade-out");

  setTimeout(()=>{
    fetch("/api/serverDelete", {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify({ id })
    }).then(()=>{
      div.remove();
    });
  }, 260);
}

// åˆæœŸãƒ­ãƒ¼ãƒ‰
loadNavIcon();
loadServers();
</script>

</body>
</html>
