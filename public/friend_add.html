<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ãƒ•ãƒ¬ãƒ³ãƒ‰è¿½åŠ </title>

<link id="theme" rel="stylesheet" href="/css/light.css">
<script src="/script/theme.js" defer></script>

<style>
body{
  font-family:"Meiryo",sans-serif;
  background:var(--bg);
  color:var(--text);
  margin:0;
}

nav{
  background:var(--card);
  padding:12px 24px;
  display:flex;
  align-items:center;
  border-bottom:1px solid var(--border);
}

nav a{
  color:var(--text);
  text-decoration:none;
  font-weight:600;
  margin-right:20px;
}
nav a:hover{
  color:var(--accent);
}

.container{
  width:90%;
  max-width:600px;
  margin:32px auto;
}

.card{
  background:var(--card);
  padding:20px;
  border-radius:12px;
  border:1px solid var(--border);
}

input{
  width:100%;
  padding:12px;
  margin-bottom:12px;
  border-radius:8px;
  border:1px solid var(--border);
  background:var(--input);
  color:var(--text);
  font-size:15px;
}

button{
  padding:10px 16px;
  background:var(--accent);
  color:white;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:600;
}
button:hover{
  opacity:0.9;
}

/* âœ¨ ãƒ•ã‚§ãƒ¼ãƒ‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
#msgBox{
  opacity:0;
  margin-top:16px;
  font-weight:bold;
  transition: opacity .5s ease;
  min-height: 22px;
}

</style>
</head>

<body>

<nav>
  <a href="/">ã‚µãƒ¼ãƒãƒ¼ä¸€è¦§</a>
  <a href="/tests.html">è‹±æ¤œ</a>
  <a href="/ranking.html">ãƒ©ãƒ³ã‚­ãƒ³ã‚°</a>
  <a href="/friend.html">ãƒ•ãƒ¬ãƒ³ãƒ‰</a>

  <button onclick="toggleTheme()" style="margin-left:auto;">ğŸŒ“</button>
</nav>

<div class="container">
  <h2>ï¼‹ ãƒ•ãƒ¬ãƒ³ãƒ‰è¿½åŠ </h2>

  <div class="card">
    <input id="addName" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›" autocomplete="off">
    <button onclick="addFriend()">ãƒ•ãƒ¬ãƒ³ãƒ‰ç”³è«‹ã‚’é€ã‚‹</button>

    <!-- âœ¨ ãƒ•ã‚§ãƒ¼ãƒ‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
    <div id="msgBox"></div>
  </div>
</div>

<script>
// ================================
// âœ¨ ãƒ•ãƒ¬ãƒ³ãƒ‰ç”³è«‹ï¼ˆãƒ•ã‚§ãƒ¼ãƒ‰è¡¨ç¤ºä»˜ãï¼‰
// ================================
async function addFriend(){
  const from = localStorage.getItem("username");
  const to   = document.getElementById("addName").value.trim();
  const box  = document.getElementById("msgBox");

  // ä¸€å›æ¶ˆã—ã¦é€æ˜ã«æˆ»ã™
  box.style.opacity = 0;

  if (!from){
    showMsg("â€» ã¾ãšãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚", "#e74c3c");
    return;
  }
  if (!to){
    showMsg("â€» ç›¸æ‰‹ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚", "#e74c3c");
    return;
  }

  const res = await fetch("/api/friends/add", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ from, to })
  });

  const data = await res.json();

  if (data.ok){
    document.getElementById("addName").value = "";
    showMsg("âœ” ãƒ•ãƒ¬ãƒ³ãƒ‰ç”³è«‹ã‚’é€ä¿¡ã—ã¾ã—ãŸï¼", "#2ecc71");
  } else {
    showMsg(data.error || "é€ä¿¡ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚", "#e74c3c");
  }
}

// ================================
// âœ¨ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºï¼ˆãµã‚ã£ã¨è¡¨ç¤º â†’ æ¶ˆãˆã‚‹ï¼‰
// ================================
function showMsg(text, color){
  const box = document.getElementById("msgBox");

  box.style.color = color;
  box.innerText = text;

  // è¡¨ç¤ºï¼ˆãµã‚ã£ã¨ï¼‰
  setTimeout(()=> box.style.opacity = 1, 50);

  // 3ç§’å¾Œã«ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ
  setTimeout(()=> box.style.opacity = 0, 3000);
}
</script>

</body>
</html>
