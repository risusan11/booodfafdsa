<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚¢ã‚¤ã‚³ãƒ³å¤‰æ›´</title>

<link id="theme" rel="stylesheet" href="/css/light.css">
<script src="/script/theme.js" defer></script>

<style>
body{
  font-family:"Meiryo",sans-serif;
  background:var(--bg);
  color:var(--text);
  margin:0;
}

nav{
  background:var(--card);
  padding:12px 24px;
  display:flex;
  align-items:center;
  border-bottom:1px solid var(--border);
}

nav a{
  color:var(--text);
  text-decoration:none;
  font-weight:600;
  margin-right:20px;
}
nav a:hover{
  color:var(--accent);
}

.container{
  width:90%;
  max-width:600px;
  margin:32px auto;
}

.card{
  background:var(--card);
  padding:20px;
  border-radius:12px;
  border:1px solid var(--border);
  text-align:center;
}

#preview{
  width:120px;
  height:120px;
  border-radius:50%;
  object-fit:cover;
  margin-bottom:16px;
}

button{
  padding:10px 16px;
  background:var(--accent);
  color:white;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:600;
}
button:hover{ opacity:0.9; }

#msg{ margin-top:16px; font-weight:bold; opacity:0; transition:.3s; }
</style>
</head>

<body>

<nav>
  <a href="/">ã‚µãƒ¼ãƒãƒ¼ä¸€è¦§</a>
  <a href="/friend.html">ãƒ•ãƒ¬ãƒ³ãƒ‰</a>
  <a href="/icon_upload.html"
     style="background:var(--accent); color:white; padding:6px 12px; border-radius:6px;">
     ã‚¢ã‚¤ã‚³ãƒ³å¤‰æ›´
  </a>
  <button onclick="toggleTheme()" style="margin-left:auto;">ğŸŒ“</button>
</nav>

<div class="container">
  <h2>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚¢ã‚¤ã‚³ãƒ³å¤‰æ›´</h2>

  <div class="card">
    <img id="preview" src="/icons/default.png">

    <input type="file" id="iconFile" accept="image/*">

    <button onclick="uploadIcon()">ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</button>

    <div id="msg"></div>
  </div>
</div>

<script>
// ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
document.getElementById("iconFile").addEventListener("change", e=>{
  const file = e.target.files[0];
  if(file){
    document.getElementById("preview").src = URL.createObjectURL(file);
  }
});

// ä¸Šä¼ 
async function uploadIcon(){
  const user = localStorage.getItem("username");
  const file = document.getElementById("iconFile").files[0];
  const msg = document.getElementById("msg");

  msg.style.opacity = 0;

  if(!user){
    msg.innerHTML = "<span style='color:red;'>â€» ã¾ãšãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’è¨­å®šã—ã¦ãã ã•ã„</span>";
    msg.style.opacity = 1;
    return;
  }
  if(!file){
    msg.innerHTML = "<span style='color:red;'>â€» ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„</span>";
    msg.style.opacity = 1;
    return;
  }

  const fd = new FormData();
  fd.append("icon", file);
  fd.append("user", user);

  const res = await fetch("/api/user/icon", {
    method:"POST",
    body: fd
  });
  const data = await res.json();

  if(data.ok){
    msg.innerHTML = "<span style='color:#2ecc71;'>âœ” ã‚¢ã‚¤ã‚³ãƒ³ã‚’æ›´æ–°ã—ã¾ã—ãŸï¼</span>";
  } else {
    msg.innerHTML = "<span style='color:red;'>ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</span>";
  }

  msg.style.opacity = 1;
}
</script>

</body>
</html>
